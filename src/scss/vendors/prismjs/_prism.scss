@use "../../abstracts/functions" as f;
@use "../../abstracts/mixins" as m;
@use "../../abstracts/variables" as v;

.code-toolbar {
	position: relative;
	margin-top: f.pxtorem(50); // toolbar height
	width: 100%;

	> .toolbar {
		display: flex;
		align-items: center;
		justify-content: flex-end;
		background: f.cssvar(color-bg-tertiary);
		border: solid f.cssvar(color-border-light);
		border-width: f.pxtorem(1) f.pxtorem(1) 0 f.pxtorem(1);
		border-top-left-radius: f.pxtorem(3);
		border-top-right-radius: f.pxtorem(3);
		box-shadow: 0 f.pxtorem(2) f.pxtorem(3) f.pxtorem(-2)
			f.cssvar(color-shadow-darker);
		width: 100%;
		height: f.pxtorem(50);
		position: absolute;
		top: f.pxtorem(-50);
		left: 0;
	}

	.toolbar-item {
		color: f.cssvar(color-fg-secondary);

		&:first-child {
			font-size: f.cssvar(font-size-sm);
			font-weight: 600;
			margin-right: auto;
			margin-left: f.cssvar(spacing-sm);
		}

		&:last-child {
			margin: 0 f.cssvar(spacing-sm);
		}

		button {
			@include m.buttonStyle3;

			color: f.cssvar(color-fg-inverted);
			font-size: f.cssvar(font-size-sm);
			height: f.pxtorem(32);
			padding: f.cssvar(spacing-3xs) f.cssvar(spacing-2xs);
		}

		.prism-theme {
			&__btn {
				width: f.pxtorem(32);
				padding: 0;
			}

			&__icon {
				display: flex;
				align-items: center;
				justify-content: center;
				padding: f.cssvar(spacing-3xs);

				svg {
					fill: f.cssvar(color-fg-inverted);
					width: 100%;
					height: 100%;
				}
			}
		}
	}

	pre {
		border-top-left-radius: 0;
		border-top-right-radius: 0;
		width: auto;
	}
}

pre {
	&[data-line] {
		position: relative;
	}

	&[class*="language-"] {
		.token {
			&.cdata,
			&.comment,
			&.prolog {
				color: f.cssvar(color-token-grey);
			}

			&.punctuation {
				color: f.cssvar(color-fg);
			}

			&.attr-name,
			&.hexcode,
			&.inserted,
			&.string {
				color: f.cssvar(color-token-green);
			}

			&.class,
			&.coord,
			&.id,
			&.function {
				color: f.cssvar(color-token-purple);
			}

			&.builtin,
			&.builtin.class-name,
			&.property-access,
			&.regex,
			&.scope {
				color: f.cssvar(color-token-magenta);
			}

			&.class-name,
			&.constant,
			&.global,
			&.interpolation,
			&.key,
			&.package,
			&.property,
			&.this,
			&.title,
			&.variable {
				color: f.cssvar(color-token-blue);
			}

			&.combinator,
			&.keyword,
			&.operator,
			&.pseudo-class,
			&.pseudo-element,
			&.rule,
			&.selector,
			&.unit {
				color: f.cssvar(color-token-orange);
			}

			&.attr-value,
			&.boolean,
			&.number {
				color: f.cssvar(color-token-yellow);
			}

			&.delimiter,
			&.doctype,
			&.parameter,
			&.parent,
			&.shebang,
			&.tag {
				color: f.cssvar(color-token-cyan);
			}

			&.deleted {
				color: f.cssvar(color-token-red);
			}

			&.deleted.prefix,
			&.important:not(.boolean),
			&.inserted.prefix,
			&.bold,
			&.this {
				font-weight: 600;
			}

			&.coord,
			&.italic {
				font-style: italic;
			}

			&.entity {
				cursor: help;
			}
		}

		.language-css,
		.language-scss {
			.token {
				&.variable {
					color: f.cssvar(color-token-cyan);
				}
			}
		}

		.language-markdown {
			.token {
				&.url {
					color: f.cssvar(color-token-yellow);

					.token.content {
						color: f.cssvar(color-token-green);
					}
				}

				&.code {
					color: f.cssvar(color-token-cyan);
				}

				&.hr.punctuation {
					color: f.cssvar(color-token-blue);
				}

				&.blockquote.punctuation {
					color: f.cssvar(color-token-magenta);
				}
			}
		}

		code {
			white-space: pre;
		}
	}

	&.line-numbers {
		counter-reset: linenumber;
		padding: 0;

		> code {
			position: relative;
			padding: f.cssvar(spacing-md) f.cssvar(spacing-sm)
				f.cssvar(spacing-md)
				calc(#{f.pxtorem(60)} + #{f.cssvar(spacing-sm)}); // gutter width + spacing
			overflow-wrap: normal;
			white-space: pre;
		}

		.line-numbers-rows {
			background: f.cssvar(color-bg-tertiary);
			letter-spacing: f.pxtorem(-1);
			position: absolute;
			top: 0;
			left: 0;
			width: f.pxtorem(60);
			padding: f.cssvar(spacing-md) 0;
			pointer-events: none;
			user-select: none;

			> span {
				display: block;
				counter-increment: linenumber;

				&::before {
					display: block;
					content: counter(linenumber);
					padding-right: f.cssvar(spacing-sm);
					text-align: right;
				}
			}
		}
	}

	&.diff-highlight {
		> code .token.deleted:not(.prefix) {
			display: block;
			background-color: rgba(140, 33, 33, 0.15);
			color: inherit;
		}

		> code .token.inserted:not(.prefix) {
			display: block;
			background-color: rgba(12, 87, 5, 0.15);
			color: inherit;
		}

		.token.unchanged {
			opacity: 0.5;
		}
	}

	&.command-line {
		overflow-wrap: normal;
		white-space: pre;

		code {
			overflow-wrap: normal;
			white-space: pre;
		}

		.command-line-prompt {
			border-right: f.pxtorem(1) solid f.cssvar(color-border-light);
			display: block;
			float: left;
			margin-right: f.cssvar(spacing-md);
			pointer-events: none;
			user-select: none;

			> span {
				&::before {
					display: block;
					content: "";
					color: f.cssvar(color-token-grey);
					padding-right: f.cssvar(spacing-sm);
				}

				&[data-user]::before {
					content: "[" attr(data-user) "@" attr(data-host) "] $";
				}

				&[data-user="root"]::before {
					content: "[" attr(data-user) "@" attr(data-host) "] #";
				}

				&[data-prompt]::before {
					content: attr(data-prompt);
				}
			}
		}
	}
}
